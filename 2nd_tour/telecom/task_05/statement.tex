\assignementTitle{Веселый спутник}{26}{}

\textbf{Тренируемые навыки: } преобразование различных типов координат, работа с массивами, фильтрация случайных выбросов, поиск максимума коэффициента корреляции последовательностей, методы поиска оптимальных значений.

\subsubsection*{Условие задачи}

Спутник занимается мониторингом землетрясений на удаленной планете. Программное обеспечение спутника позволяет определять границы континентов и местоположение эпицентра землетрясения. Зная его ориентацию и орбиту программы спутника позволяют определять географические координаты землетрясения и передавать их на Землю.

В процессе функционирования блок, отвечающий за ориентацию спутника вышел из строя, и спутник начал вращаться по очень сложной орбите, которую нельзя скорректировать и блок расчета координат землетрясения перестал функционировать. Съемка границ континентов и привязка к ним эпицентра землетрясения продолжает работать и это информация предаётся на Землю в виде трехмерного образа планеты (а именно в виде последовательности нулей, единиц и двоек). Единицам соответствуют границы континентов, двойкам - местоположение эпицентра землетрясения, нулям - все остальные точки. Контуры континентов расположены на поверхности воображаемой сферы с неизвестным радиусом, центром и ориентацией (они стали неизвестны из-за сбоя орбиты спутника). Кроме того, в данных может присутствовать случайный шум из единиц, возникший из-за передачи большого объема данных.

Задача: Сделать программу, которая по полученному трехмерному образу планеты (заданному файлом в виде последовательности 0, 1 и 2) и двумерной карте материков (заданному файлом в виде последовательности координат каждой границы - широта и долгота) определяет географические координаты землетрясения с точностью не хуже удвоенного размера дискрета в первом файле.

\explaneSection

\putImgWOCaption{13cm}{1}
\putImgWOCaption{13cm}{2}

Красная точка [2] на верхнем рисунке -- эпицентр землетрясения, который надо определить.

Синие точки -- границы континентов и случайный шум, остальные точки -- нули.

Снизу -- карта неизвестной планеты.
 
\textit{Описание формата входных и выходных данных для задачи:}

Порядок следования данных: $x[0][0][0],$ $x[0][0][1],$ $x[0][0][2]$, \dots , $x[0][0][N]$, $x[0][1][0],$ \linebreak $x[0][1][1], x[0][1][2], .... x[0][N][N], x[1][0][0], x[1][0][1], ... , x[N][N][N].$ Трехмерный массив $201\times 201\times 201$.

Соответствующие им результаты работы программы приведены в файлах out1.txt, out2.txt и out3.txt

Оцифрованная карта материков приведена в файле world\_110m.txt:

долгота1 широта1
долгота2 широта 2
...
долготаN широта N

В файле world\_110m.txt могут встречаться пустые строки

Языки программирования - Python,C,C++,Java

Программа должна читать исходный файл со стандартного потока stdin и передавать решение на стандартный поток stdout

\textit{Требования к программе:}

    Программа должна читать исходные данные со стандартного потока ввода (stdin) и выдавать его на стандартный поток вывода (stdout).
    
В процессе работы она может читать файл двумерной карты материков, имеющий название world\_110m.txt 

\textit{Количество начисляемых баллов:}

Для проверки решения в различных начальных условиях используется несколько тестовых примеров (в этой задаче - 10 тестовых примеров). По каждому примеру определялось количество баллов, заработанное командой в этом примере. Результирующая оценка команды за задачу вычисляется, как среднее значение по проведенным тестам:

$$\text{Количество баллов за задачу} = \frac{1}{10} \sum_{i = 1}^{10} Q_i$$

Баллы за каждый тест рассчитываются следующим образом.

Если программа успешно выполнила тест за 5 минут, то команда получает за этот тест половину максимального количества баллов $Q_i = 13$.

Если программа успешно выполнила тест за 2.5 или менее минут, команда получает  за этот тест максимальное количество баллов $Q_i = 26$.

Если программа успешно выполнила тест за время $T$ от 2.5 до 5 минут команда получает   за этот тест
$$ Q_i=(1-(T-2.5)/5) \cdot 26 \: \text{баллов}$$

Если программа выполняет тест более 5 минут или выполнила его неуспешно,  команда получает  за этот тест 0 баллов.

Проверка проводилась в несколько этапов(попыток), проводимых в заданную дату (20.12.2018; 29.12.2018; 06.01.2019; 11.01.2019; 14.01.2019). В каждой попытке участники могли загрузить и проверить одно свое решение этой задачи.

Результирующая оценка за задачу выбиралась, как максимальная из попыток.

Загрузка решений проводилась на сайте \url{http://dep1.iszf.irk.ru/wlcomm} на котором было установлено специальное программное обеспечение для регистрации, разделения доступа и возможности загрузки решений участниками.
Тестирование решений проводилось на виртуальной машине с установленной ОС Kubuntu, проверку и начисление баллов за каждый тест осуществляли автоматические программы.

\subsection*{Алгоритм решения задачи}

\begin{enumerate}
    \item Удалить шум. Поскольку он имеет вид случайных выбросов, можно удалить все точки со значением равным 1, у которых нет соседей со значением равным 1 в трех измерениях (т.е. в ближайших 26 ячейках). Все остальные точки будут находиться на поверхности некой сферы или не дальше одного дискрета сетки от нее.  Удаление шума можно сделать, например предварительно занеся исходные данные в трехмерный массив координат $(x,y,z)$ и проверив число соседей со значением равным 1 у каждой клетки.
    \item Определить центр и радиус сферы. Один из способов - поиск оптимального значения функции невязки прямым перебором координат. 
    
    Условием оптимального значения является такое положение центра $(x_c, y_c, z_c)$ при котором  минимален разброс расстояния между центром и точками, со значением, равным 1 в смысле:
    $$\sum_{i=1}^N(r_i -R)^2 = min \qquad (1)$$
    
    где

    $$r_i = \sqrt{(x_c - x_i)^2 + (y_c - y_i)^2 + (z_c-z_i)^2} \qquad (2)$$
    
    - расстояние от центра $(x_c, y_c, z_c)$ с координатами до i-ой точки со значением 1 с координатами $(x_i, y_i, z_i)$
    $$R=\frac{1}{N} \sum_{i=1}^N r_i \qquad (3)$$
    
    - среднее расстояние от центра до точек со значением 1.

    при этом R будет радиусом этой сферы, а $(x_c, y_c, z_c)$, на которых этот минимум (1) достигается, являются координатами центра.

    На первом этапе можно перебирать значения $(x_c, y_c, z_c)$ с шагом в 1 градус в пределах  $-50 \leq x_c \leq 50; -50 \leq y_c \leq 50; -50 \leq z_c \leq 50$, на втором этапе уточнить найденное значение перебором с шагом в 0.2 градуса вблизи найденного на первом этапе значения. 

    \item Перевести получившиеся точки со значениями 1 или 2 в сферические координаты (широта,долгота) на эквидистантную (прямоугольную) сетку, с шагом в 1 градус по широте и долготе.
    \item Перевести карту планеты, заданную в файле world\_110m.txt в сферические координаты на идентичную пункту 4 сетку.
    \item Одним из методов поиска, например перебором с шагом в 1 градус найти  сдвиг сферических координат (широта, долгота) при котором положения точек со значением 1 на сетках, полученных на этапах 4 и 5, дают наибольшее количество совпадений. 
    \item Вычислить координаты эпицентра (точки со значением 2) исходя из найденного оптимального положения.
\end{enumerate}